<?xml version="1.0" encoding="utf-8"?>

<project name="extensionFunction" basedir="." default="all">
    
    <property name="lib.dir" value="${basedir}/lib"/>
    <property name="saxon.jar" value="${lib.dir}/saxon-he-10.jar"/>
    <property name="src.dir" value="${basedir}/src"/>
    <property name="dist.dir" value="${basedir}/dist"/>
    <property name="classes.dir" value="${basedir}/classes"/>
    <property name="snowball.dir" value="${lib.dir}/snowball/java"/>
    <property name="snowball.jar" value="${dist.dir}/snowball.jar"/>
    <property name="extension.jar" value="${dist.dir}/extension.jar"/>
    
    
    
    <target name="setup">
        <delete dir="${classes.dir}"/>
        <delete dir="${dist.dir}"/>
        <mkdir dir="${classes.dir}"/>
        <mkdir dir="${dist.dir}"/>
    </target>
    
    <target name="compile.snowball">
        <javac srcdir="${snowball.dir}" destdir="${classes.dir}"
            includeantruntime="false">
            <include name="org/**/**.java"/>
        </javac>
        <jar destfile="${snowball.jar}"
            basedir="${classes.dir}"
            includes="org/**/*.class"/>
    </target>
    
    <target name="compile.extension">
        <javac srcdir="${src.dir}" destdir="${classes.dir}"
            includeantruntime="false" classpath="${saxon.jar}">
            <include name="**/**.java"/>
        </javac>
        <jar destfile="dist/extension.jar" basedir="classes" includes="com/**/*.class"/>
    </target>
    
    
    <target name="compile" depends="compile.snowball, compile.extension"/>
    
    <target name="test">
        <java classname="net.sf.saxon.Transform" failonerror="true" fork="true">
            <classpath>
                <path path="${extension.jar}"/>
                <path path="${snowball.jar}"/>
                <path path="${saxon.jar}"/>
            </classpath>
            <arg line="-it:go"/>
            <arg line="-xsl:test.xsl"/>
            <arg line="-config:saxon_config.xml"/>
        </java>
    </target>

    
    <target name="all" depends="setup, compile, test"/>
</project>
